---
title: "use"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{use}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(ormr)
```

# Introduction

 * Install a Conda environment
 * Install Python packages
 * Run a Python script with that Conda environment and packages

We use only one point of contact, `ormr_folder_name`,
which is the folder where `ormr` installs the Python environment and packages
needed:

```{r}
ormr_folder_name <- tempfile()
ormr_folder_name
```

Initially, nothing is installed, this must be verified

```{r}
testthat::expect_false(
  is_miniconda_installed(ormr_folder_name = ormr_folder_name)
)
```

Time to install Conda (or any other environment):

```{r}
install_miniconda(ormr_folder_name = ormr_folder_name)
testthat::expect_true(
  is_miniconda_installed(
    ormr_folder_name = ormr_folder_name
  )
)
```

Get a list of the installed Python packages
(or more likely: a tibble):

```{r}
installed_python_packages <- list_python_packages(
  ormr_folder_name = ormr_folder_name
)
knitr::kable(installed_python_packages)
```

Tensorflow (or any other absent package) will not be in that list yet:

```{r}
package_name <- "tensorflow"
testthat::expect_false(package_name %in% installed_python_packages$package) 
```


Install it:

THIS IS WHERE NO CODE IS BEING RUN

```
install_python_packages(
  ormr_folder_name = ormr_folder_name,
  package_names = package_name
)
```

Now the Python package should be installed:

```
installed_python_packages <- list_python_packages(
  ormr_folder_name = ormr_folder_name
)
testthat::expect_true(package_name %in% installed_python_packages$package) 
```

Great, with our environment and packages in place,
we run a Python script with those packages with command-line arguments

```
python_script_path <- system.file("extdata", "run_gcae.py", package = "ormr")
output <- run_python_script(
  ormr_folder_name = ormr_folder_name,
  python_script_path = python_script_path,
  args = "--help"
)
testthat::expect_true(length(output) > 0)
```
